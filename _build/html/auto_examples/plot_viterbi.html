

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Viterbi decoding &mdash; librosa 0.7.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../',
              VERSION:'0.7.0',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../_static/banner.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="PCEN Streaming" href="plot_pcen_stream.html" />
    <link rel="prev" title="Superflux onsets" href="plot_superflux.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> librosa
          

          
          </a>

          
            
            
              <div class="version">
                0.7
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial.html">Tutorial</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../core.html">Core IO and DSP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../display.html">Display</a></li>
<li class="toctree-l1"><a class="reference internal" href="../feature.html">Feature extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../onset.html">Onset detection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../beat.html">Beat and tempo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../decompose.html">Spectrogram decomposition</a></li>
<li class="toctree-l1"><a class="reference internal" href="../effects.html">Effects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../output.html">Output</a></li>
<li class="toctree-l1"><a class="reference internal" href="../segment.html">Temporal segmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sequence.html">Sequential modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../util.html">Utilities</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../filters.html">Filters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cache.html">Caching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ioformats.html">Advanced I/O Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced.html">Advanced examples</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">librosa</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../advanced.html">Advanced examples</a> &raquo;</li>
        
      <li>Viterbi decoding</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/auto_examples/plot_viterbi.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  





<div class="sphx-glr-download-link-note admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Click <a class="reference internal" href="#sphx-glr-download-auto-examples-plot-viterbi-py"><span class="std std-ref">here</span></a> to download the full example code</p>
</div>
<div class="sphx-glr-example-title section" id="viterbi-decoding">
<span id="sphx-glr-auto-examples-plot-viterbi-py"></span><h1>Viterbi decoding<a class="headerlink" href="#viterbi-decoding" title="Permalink to this headline">¶</a></h1>
<p>This notebook demonstrates how to use Viterbi decoding to impose temporal
smoothing on frame-wise state predictions.</p>
<p>Our working example will be the problem of silence/non-silence detection.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Code source: Brian McFee</span>
<span class="c1"># License: ISC</span>

<span class="c1">##################</span>
<span class="c1"># Standard imports</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">librosa</span>

<span class="kn">import</span> <span class="nn">librosa.display</span>
</pre></div>
</div>
<p>Load an example signal</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">y</span><span class="p">,</span> <span class="n">sr</span> <span class="o">=</span> <span class="n">librosa</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;audio/sir_duke_slow.mp3&#39;</span><span class="p">)</span>


<span class="c1"># And compute the spectrogram magnitude and phase</span>
<span class="n">S_full</span><span class="p">,</span> <span class="n">phase</span> <span class="o">=</span> <span class="n">librosa</span><span class="o">.</span><span class="n">magphase</span><span class="p">(</span><span class="n">librosa</span><span class="o">.</span><span class="n">stft</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>


<span class="c1">###################</span>
<span class="c1"># Plot the spectrum</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">librosa</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">specshow</span><span class="p">(</span><span class="n">librosa</span><span class="o">.</span><span class="n">amplitude_to_db</span><span class="p">(</span><span class="n">S_full</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">),</span>
                         <span class="n">y_axis</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">x_axis</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="n">sr</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../_images/sphx_glr_plot_viterbi_001.png" class="sphx-glr-single-img" src="../_images/sphx_glr_plot_viterbi_001.png" />
<p>As you can see, there are periods of silence and
non-silence throughout this recording.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># As a first step, we can plot the root-mean-square (RMS) curve</span>
<span class="n">rms</span> <span class="o">=</span> <span class="n">librosa</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">rms</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">times</span> <span class="o">=</span> <span class="n">librosa</span><span class="o">.</span><span class="n">frames_to_time</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rms</span><span class="p">)))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">rms</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;RMS&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="c1"># The red line at 0.02 indicates a reasonable threshold for silence detection.</span>
<span class="c1"># However, the RMS curve occasionally dips below the threshold momentarily,</span>
<span class="c1"># and we would prefer the detector to not count these brief dips as silence.</span>
<span class="c1"># This is where the Viterbi algorithm comes in handy!</span>
</pre></div>
</div>
<img alt="../_images/sphx_glr_plot_viterbi_002.png" class="sphx-glr-single-img" src="../_images/sphx_glr_plot_viterbi_002.png" />
<p>As a first step, we will convert the raw RMS score
into a likelihood (probability) by logistic mapping</p>
<blockquote>
<div><span class="math notranslate nohighlight">\(P[V=1 | x] = \frac{\exp(x - \tau)}{1 + \exp(x - \tau)}\)</span></div></blockquote>
<p>where <span class="math notranslate nohighlight">\(x\)</span> denotes the RMS value and <span class="math notranslate nohighlight">\(\tau=0.02\)</span> is our threshold.
The variable <span class="math notranslate nohighlight">\(V\)</span> indicates whether the signal is non-silent (1) or silent (0).</p>
<p>We’ll normalize the RMS by its standard deviation to expand the
range of the probability vector</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">r_normalized</span> <span class="o">=</span> <span class="p">(</span><span class="n">rms</span> <span class="o">-</span> <span class="mf">0.02</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">rms</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">r_normalized</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">r_normalized</span><span class="p">))</span>

<span class="c1"># We can plot the probability curve over time:</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;P[V=1|x]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Descision threshold&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../_images/sphx_glr_plot_viterbi_003.png" class="sphx-glr-single-img" src="../_images/sphx_glr_plot_viterbi_003.png" />
<p>which looks much like the first plot, but with the decision threshold
shifted to 0.5.  A simple silence detector would classify each frame
independently of its neighbors, which would result in the following plot:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">librosa</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">specshow</span><span class="p">(</span><span class="n">librosa</span><span class="o">.</span><span class="n">amplitude_to_db</span><span class="p">(</span><span class="n">S_full</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">),</span>
                         <span class="n">y_axis</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">x_axis</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="n">sr</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">p</span><span class="o">&gt;=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Non-silent&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../_images/sphx_glr_plot_viterbi_004.png" class="sphx-glr-single-img" src="../_images/sphx_glr_plot_viterbi_004.png" />
<p>We can do better using the Viterbi algorithm.
We’ll use state 0 to indicate silent, and 1 to indicate non-silent.
We’ll assume that a silent frame is equally likely to be followed
by silence or non-silence, but that non-silence is slightly
more likely to be followed by non-silence.
This is accomplished by building a self-loop transition matrix,
where <em class="xref py py-obj">transition[i, j]</em> is the probability of moving from state
<em class="xref py py-obj">i</em> to state <em class="xref py py-obj">j</em> in the next frame.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">transition</span> <span class="o">=</span> <span class="n">librosa</span><span class="o">.</span><span class="n">sequence</span><span class="o">.</span><span class="n">transition_loop</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">transition</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[[0.5 0.5]
 [0.4 0.6]]
</pre></div>
</div>
<p>Our <em class="xref py py-obj">p</em> variable only indicates the probability of non-silence,
so we need to also compute the probability of silence as its complement.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">full_p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p</span><span class="p">,</span> <span class="n">p</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">full_p</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[[0.666662   0.66666806 0.66667175 0.6666764  0.66666627 0.6666547
  0.66665447 0.6666441  0.6666499  0.6666609  0.6666492  0.6666572
  0.6666586  0.65281963 0.5593039  0.50396335 0.46875727 0.44503105
  0.44209725 0.44649702 0.45015687 0.45296526 0.47192842 0.50088567
  0.533761   0.57154465 0.60663986 0.63306737 0.6560469  0.66306615
  0.6656199  0.66632414 0.66658187 0.6666868  0.66669434 0.6666857
  0.6666565  0.66665673 0.66667044 0.66668785 0.666713   0.6667024
  0.6666863  0.66668093 0.66668844 0.6667025  0.6666882  0.66659105
  0.666566   0.66656137 0.66658425 0.6666702  0.6666781  0.6666808
  0.66664445 0.6666428  0.66665864 0.6666496  0.66597325 0.6332568
  0.565287   0.51315165 0.46493763 0.4289661  0.4174757  0.43100828
  0.4557107  0.44279826 0.40919942 0.36801213 0.33117193 0.32734305
  0.33589602 0.34995204 0.36854565 0.38243645 0.3977514  0.40770733
  0.41529024 0.4371997  0.44843513 0.45536363 0.467516   0.4552685
  0.45985198 0.47037643 0.4920172  0.5279733  0.5675844  0.6191045
  0.65206957 0.6615278  0.66489464 0.66609466 0.66653544 0.66668046
  0.6665775  0.5691235  0.46814352 0.40058243 0.34356403 0.31266928
  0.30578673 0.33672208 0.38994128 0.3435294  0.27476007 0.21300626
  0.1649099  0.15554106 0.15957916 0.15955073 0.16644585 0.17588961
  0.18820965 0.21075326 0.25177717 0.2630303  0.26994652 0.26190835
  0.22955096 0.22823173 0.23443395 0.24548048 0.27291352 0.33201182
  0.4081216  0.5046619  0.61227214 0.6514728  0.6617671  0.66529995
  0.6661643  0.6663485  0.666373   0.66623986 0.66632605 0.6662947
  0.66633373 0.6665311  0.66661215 0.6667119  0.66673124 0.65877396
  0.5928714  0.5039606  0.45510268 0.419837   0.40622658 0.42472404
  0.4426089  0.46210468 0.47377384 0.48761213 0.49827498 0.5211023
  0.5527549  0.5727336  0.5550959  0.51402926 0.4782467  0.45356333
  0.44303155 0.4642986  0.4916439  0.5032611  0.5192526  0.49856967
  0.47524315 0.47296286 0.4741637  0.47653228 0.4792863  0.48997647
  0.5133821  0.5423028  0.5859402  0.6291387  0.6509739  0.6619408
  0.6645152  0.6653484  0.6654525  0.61951697 0.4705053  0.3777169
  0.32032567 0.284069   0.2920292  0.31536585 0.33947343 0.3635468
  0.38816082 0.41106814 0.4289037  0.45955908 0.46007532 0.45066845
  0.43513745 0.40234917 0.39231366 0.39058793 0.39216512 0.42476535
  0.42306644 0.3879364  0.35002232 0.30539632 0.29092264 0.29614902
  0.31410837 0.3347454  0.3778159  0.4375978  0.50792474 0.60124874
  0.6505161  0.6203172  0.42866927 0.30231488 0.22557634 0.17425478
  0.15799701 0.16310495 0.18772101 0.21032327 0.21690273 0.21076727
  0.18132645 0.16777033 0.17310756 0.18597764 0.20130521 0.21142936
  0.22859299 0.27624983 0.34608388 0.44942784 0.5088073  0.28546447
  0.17546159 0.10721201 0.07273525 0.0705992  0.07627285 0.09409553
  0.11961043 0.16860425 0.24203545 0.3360399  0.5044182  0.6321925
  0.65276194 0.66058636 0.66487104 0.6659316  0.6660775  0.43917018
  0.18581885 0.09230238 0.05653769 0.04559535 0.05671984 0.07201564
  0.10393113 0.09749347 0.08757359 0.08931887 0.07750875 0.09155202
  0.11476034 0.13472623 0.1479373  0.15648854 0.14926326 0.12743145
  0.12095761 0.13677686 0.11081856 0.08474755 0.06102765 0.04243284
  0.04023421 0.04600978 0.05659968 0.07429123 0.12322557 0.20831406
  0.35310817 0.58769083 0.65173566 0.65917313 0.6629694  0.66426927
  0.6655723  0.66618633 0.66639227 0.6664892  0.66649926 0.6664754
  0.66647923 0.6664742  0.6664441  0.66638243 0.6663059  0.66631424
  0.6663816  0.6663896 ]
 [0.33333805 0.3333319  0.33332822 0.3333236  0.33333376 0.33334526
  0.33334553 0.33335593 0.33335012 0.3333391  0.33335075 0.33334276
  0.33334142 0.34718034 0.44069612 0.49603662 0.5312427  0.55496895
  0.55790275 0.553503   0.54984313 0.54703474 0.5280716  0.49911433
  0.46623895 0.42845538 0.3933601  0.36693263 0.34395307 0.33693385
  0.3343801  0.3336759  0.3334181  0.33331323 0.33330566 0.3333143
  0.33334354 0.33334324 0.3333296  0.33331212 0.333287   0.33329758
  0.33331367 0.33331904 0.33331156 0.33329752 0.3333118  0.33340892
  0.33343402 0.3334386  0.33341572 0.33332983 0.33332193 0.3333192
  0.33335555 0.33335721 0.33334133 0.33335045 0.33402675 0.36674318
  0.434713   0.48684838 0.5350624  0.5710339  0.5825243  0.5689917
  0.5442893  0.55720174 0.5908006  0.63198787 0.66882807 0.67265695
  0.664104   0.65004796 0.63145435 0.61756355 0.6022486  0.59229267
  0.58470976 0.5628003  0.5515649  0.54463637 0.532484   0.5447315
  0.540148   0.52962357 0.5079828  0.4720267  0.43241563 0.38089547
  0.34793046 0.3384722  0.33510536 0.33390537 0.33346456 0.33331957
  0.33342248 0.4308765  0.5318565  0.59941757 0.65643597 0.6873307
  0.6942133  0.6632779  0.6100587  0.6564706  0.72523993 0.78699374
  0.8350901  0.84445894 0.84042084 0.8404493  0.83355415 0.8241104
  0.81179035 0.78924674 0.7482228  0.7369697  0.7300535  0.73809165
  0.77044904 0.7717683  0.76556605 0.7545195  0.7270865  0.6679882
  0.5918784  0.49533808 0.38772783 0.3485272  0.3382329  0.33470005
  0.3338357  0.33365148 0.33362702 0.33376014 0.33367398 0.33370528
  0.33366627 0.3334689  0.33338785 0.33328804 0.33326873 0.34122604
  0.4071286  0.49603936 0.5448973  0.580163   0.5937734  0.57527596
  0.5573911  0.5378953  0.52622616 0.5123879  0.501725   0.47889766
  0.44724515 0.42726642 0.44490412 0.4859707  0.5217533  0.54643667
  0.55696845 0.5357014  0.5083561  0.4967389  0.4807474  0.50143033
  0.52475685 0.52703714 0.5258363  0.5234677  0.5207137  0.51002353
  0.48661795 0.4576972  0.41405982 0.3708613  0.3490261  0.33805922
  0.3354848  0.33465162 0.3345475  0.38048306 0.5294947  0.6222831
  0.6796743  0.715931   0.7079708  0.68463415 0.6605266  0.6364532
  0.6118392  0.58893186 0.5710963  0.5404409  0.5399247  0.54933155
  0.56486255 0.5976508  0.60768634 0.6094121  0.6078349  0.57523465
  0.57693356 0.6120636  0.6499777  0.6946037  0.70907736 0.703851
  0.6858916  0.6652546  0.6221841  0.5624022  0.49207526 0.39875126
  0.3494839  0.37968278 0.5713307  0.6976851  0.77442366 0.8257452
  0.842003   0.83689505 0.812279   0.7896767  0.78309727 0.78923273
  0.81867355 0.8322297  0.82689244 0.81402236 0.7986948  0.78857064
  0.771407   0.7237502  0.6539161  0.55057216 0.49119267 0.71453553
  0.8245384  0.892788   0.92726475 0.9294008  0.92372715 0.9059045
  0.8803896  0.83139575 0.75796455 0.6639601  0.4955818  0.36780748
  0.34723803 0.3394136  0.33512896 0.3340684  0.3339225  0.5608298
  0.81418115 0.9076976  0.9434623  0.95440465 0.94328016 0.92798436
  0.8960689  0.90250653 0.9124264  0.9106811  0.92249125 0.908448
  0.88523966 0.8652738  0.8520627  0.84351146 0.85073674 0.87256855
  0.8790424  0.86322314 0.88918144 0.91525245 0.93897235 0.95756716
  0.9597658  0.9539902  0.9434003  0.9257088  0.87677443 0.79168594
  0.64689183 0.41230914 0.34826434 0.3408269  0.3370306  0.33573073
  0.33442768 0.3338137  0.33360773 0.33351082 0.33350074 0.33352455
  0.33352077 0.33352575 0.33355588 0.33361757 0.33369413 0.33368573
  0.3336184  0.3336104 ]]
</pre></div>
</div>
<p>Now, we’re ready to decode!
We’ll use <em class="xref py py-obj">viterbi_discriminative</em> here, since the inputs are
state likelihoods conditional on data (in our case, data is rms).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">states</span> <span class="o">=</span> <span class="n">librosa</span><span class="o">.</span><span class="n">sequence</span><span class="o">.</span><span class="n">viterbi_discriminative</span><span class="p">(</span><span class="n">full_p</span><span class="p">,</span> <span class="n">transition</span><span class="p">)</span>

<span class="c1"># sphinx_gallery_thumbnail_number = 5</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">librosa</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">specshow</span><span class="p">(</span><span class="n">librosa</span><span class="o">.</span><span class="n">amplitude_to_db</span><span class="p">(</span><span class="n">S_full</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">),</span>
                         <span class="n">y_axis</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">x_axis</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">sr</span><span class="o">=</span><span class="n">sr</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelbottom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">p</span><span class="o">&gt;=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Frame-wise&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">states</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Viterbi&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../_images/sphx_glr_plot_viterbi_005.png" class="sphx-glr-single-img" src="../_images/sphx_glr_plot_viterbi_005.png" />
<p>Note how the Viterbi output has fewer state changes than the frame-wise
predictor, and it is less sensitive to momentary dips in energy.
This is controlled directly by the transition matrix.
A higher self-transition probability means that the decoder is less
likely to change states.</p>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  2.617 seconds)</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-plot-viterbi-py">
<div class="sphx-glr-download docutils container">
<a class="reference download internal" href="../_downloads/plot_viterbi.py" download=""><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_viterbi.py</span></code></a></div>
<div class="sphx-glr-download docutils container">
<a class="reference download internal" href="../_downloads/plot_viterbi.ipynb" download=""><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_viterbi.ipynb</span></code></a></div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="plot_pcen_stream.html" class="btn btn-neutral float-right" title="PCEN Streaming" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="plot_superflux.html" class="btn btn-neutral float-left" title="Superflux onsets" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2013--2019, librosa development team

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: 0.7.0
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Tags</dt>
            <dd><a href="../0.4.1/index.html">0.4.1</a></dd>
            <dd><a href="../0.4.2/index.html">0.4.2</a></dd>
            <dd><a href="../0.4.3/index.html">0.4.3</a></dd>
            <dd><a href="../0.5.0/index.html">0.5.0</a></dd>
            <dd><a href="../0.5.1/index.html">0.5.1</a></dd>
            <dd><a href="../0.6.0/index.html">0.6.0</a></dd>
            <dd><a href="../0.6.1/auto_examples/plot_viterbi.html">0.6.1</a></dd>
            <dd><a href="../0.6.2/auto_examples/plot_viterbi.html">0.6.2</a></dd>
            <dd><a href="../0.6.3/auto_examples/plot_viterbi.html">0.6.3</a></dd>
            <dd><a href="../0.7.0/auto_examples/plot_viterbi.html">0.7.0</a></dd>
            <dd><a href="../v0.1.0/index.html">v0.1.0</a></dd>
            <dd><a href="../v0.4.0/index.html">v0.4.0</a></dd>
        </dl>
        <dl>
            <dt>Branches</dt>
            <dd><a href="../master/auto_examples/plot_viterbi.html">master</a></dd>
        </dl>
    </div>
</div>


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>